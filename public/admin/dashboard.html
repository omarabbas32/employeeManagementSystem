<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - EMS</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>

<body>
    <div class="page-wrapper">
        <div id="sidebar-container"></div>

        <div class="main-content">
            <div class="card">
                <h1>Admin Dashboard</h1>
                <p class="text-muted">Welcome to the Employee Management System</p>
            </div>

            <div class="grid grid-4" id="stats-grid">
                <!-- Stats will be loaded here -->
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Quick Actions</h3>
                </div>
                <div class="card-body">
                    <div class="grid grid-3 gap-2">
                        <a href="employees.html" class="btn btn-primary">
                            ðŸ‘¥ Manage Employees
                        </a>
                        <a href="tasks.html" class="btn btn-primary">
                            ðŸ“‹ Manage Tasks
                        </a>
                        <a href="payroll.html" class="btn btn-primary">
                            ðŸ’µ Generate Payroll
                        </a>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Recent Activity</h3>
                </div>
                <div class="card-body" id="recent-activity">
                    <p class="text-muted">Loading recent activity...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="../js/api.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/components.js"></script>
    <script>
        // Protect page - Admin only
        if (!auth.init('Admin')) {
            throw new Error('Unauthorized');
        }

        // Render sidebar
        document.getElementById('sidebar-container').innerHTML = createSidebar('Admin', 'dashboard');

        // Load dashboard data
        async function loadDashboard() {
            try {
                showLoading();

                const [employees, tasks, settings] = await Promise.all([
                    api.getEmployees(),
                    api.getTasks(),
                    api.getSettings()
                ]);

                // Calculate stats
                const totalEmployees = employees.length;
                const totalTasks = tasks.length;
                const completedTasks = tasks.filter(t => t.status === 'Done').length;
                const pendingTasks = tasks.filter(t => t.status === 'Pending').length;

                // Render stats
                const statsGrid = document.getElementById('stats-grid');
                statsGrid.innerHTML = `
          <div class="stat-card">
            <h3>${totalEmployees}</h3>
            <p>Total Employees</p>
          </div>
          <div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
            <h3>${completedTasks}</h3>
            <p>Completed Tasks</p>
          </div>
          <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
            <h3>${pendingTasks}</h3>
            <p>Pending Tasks</p>
          </div>
          <div class="stat-card" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
            <h3>${totalTasks}</h3>
            <p>Total Tasks</p>
          </div>
        `;

                // Show recent tasks
                const recentTasks = tasks.slice(0, 5);
                const activityContainer = document.getElementById('recent-activity');

                if (recentTasks.length === 0) {
                    activityContainer.innerHTML = '<p class="text-muted">No recent tasks</p>';
                } else {
                    activityContainer.innerHTML = `
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>Task</th>
                    <th>Assigned To</th>
                    <th>Status</th>
                    <th>Created</th>
                  </tr>
                </thead>
                <tbody>
                  ${recentTasks.map(task => {
                        const employee = employees.find(e => e.id === task.assignedEmployeeId);
                        return `
                      <tr>
                        <td><strong>${utils.escapeHtml(task.title)}</strong></td>
                        <td>${employee ? utils.escapeHtml(employee.name) : 'Unknown'}</td>
                        <td><span class="badge ${utils.getStatusBadgeClass(task.status)}">${task.status}</span></td>
                        <td>${utils.formatDateReadable(task.createdAt)}</td>
                      </tr>
                    `;
                    }).join('')}
                </tbody>
              </table>
            </div>
          `;
                }

                hideLoading();
            } catch (error) {
                hideLoading();
                showToast('Failed to load dashboard data: ' + error.message, 'error');
            }
        }

        loadDashboard();
    </script>
</body>

</html>